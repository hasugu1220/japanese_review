<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>일본어 학습 프로그램 V7 - 완전판</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f3f4f6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        /* 헤더 */
        .header {
            background: white;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.1rem;
            color: #7c3aed;
            font-weight: 600;
        }

        .menu-btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            position: relative;
        }

        /* 메뉴 드롭다운 */
        .menu-dropdown {
            position: fixed;
            top: 60px;
            right: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 150px;
            max-width: calc(100% - 32px);
            overflow: hidden;
        }

        .menu-dropdown.show {
            display: block;
        }

        .menu-item {
            padding: 14px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s;
            font-size: 14px;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: #faf5ff;
        }

        .menu-item.active {
            background: #7c3aed;
            color: white;
        }

        /* 오버레이 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* 메인 컨텐츠 */
        .main-content {
            padding: 16px;
            min-height: calc(100vh - 60px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        h2 {
            font-size: 1.2rem;
            margin-bottom: 16px;
            color: #374151;
        }

        /* 모드 선택 버튼 */
        .mode-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            background: #f5f5f5;
            padding: 4px;
            border-radius: 12px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            color: #666;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: white;
            color: #7c3aed;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
        }

        /* 필터 드롭다운 */
        .filter-dropdown {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            margin-bottom: 16px;
        }

        /* 단어 리스트 */
        .interactive-vocab-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        /* 단어 카드 */
        .interactive-word-card {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            padding: 16px;
            border-radius: 16px;
            min-height: 88px;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.2);
        }

        .word-column {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 6px;
        }

        .japanese-word {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.3;
        }

        .japanese-word ruby rt {
            font-size: 0.55em;
            opacity: 0.9;
        }

        .word-meaning {
            font-size: 0.95rem;
            opacity: 0.9;
            color: #f0f8ff;
            font-weight: 500;
        }

        /* 액션 버튼 - 2x2 그리드 */
        .action-buttons {
            display: grid;
            grid-template-columns: 38px 38px;
            grid-template-rows: 32px 32px;
            gap: 3px;
        }

        .action-btn-small {
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn-small:active {
            transform: scale(0.95);
        }

        .action-btn-small.active {
            background: white;
            color: #7c3aed;
        }

        .action-btn-small:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-know {
            background: rgba(34, 197, 94, 0.25);
            border-color: rgba(34, 197, 94, 0.5);
        }

        .btn-dont-know {
            background: rgba(239, 68, 68, 0.25);
            border-color: rgba(239, 68, 68, 0.5);
        }

        .btn-dont-know.checked {
            background: #ef4444;
            border-color: #ef4444;
        }

        /* 아는 단어 그리드 */
        .known-words-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        .known-word-card {
            background: linear-gradient(135deg, #22c55e 0%, #84cc16 100%);
            color: white;
            padding: 14px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(34, 197, 94, 0.2);
        }

        /* 퀴즈 스타일 */
        .quiz-card {
            background: #f9fafb;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .quiz-progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .quiz-progress-fill {
            background: linear-gradient(90deg, #7c3aed 0%, #a855f7 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
            line-height: 1.5;
            color: #374151;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            padding: 14px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
            transition: all 0.2s ease;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quiz-option:active {
            transform: scale(0.98);
        }

        .quiz-option.correct {
            background: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }

        .quiz-option.wrong {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        /* 질문 생성기 */
        .generator-section {
            background: #f9fafb;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .question-card-single {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }

        .question-japanese {
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 16px;
            color: #111827;
        }

        .question-korean {
            font-size: 1.1rem;
            color: #6b7280;
            text-align: center;
        }

        /* 버튼 스타일 */
        .action-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 16px;
        }

        .generate-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
        }

        .generate-btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
        }

        .generate-btn-secondary {
            background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            color: white;
        }

        .empty-message {
            text-align: center;
            padding: 48px 24px;
            color: #9ca3af;
            font-size: 1rem;
        }

        .hidden {
            display: none;
        }

        /* 스크롤바 숨기기 */
        ::-webkit-scrollbar {
            width: 0;
            display: none;
        }

        /* PC에서 보기 */
        @media (min-width: 768px) {
            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 20px;
            }
            
            .app-container {
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                border-radius: 20px;
                overflow: hidden;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 헤더 -->
        <div class="header">
            <h1>일본어 학습 V7</h1>
            <div style="position: relative;">
                <button class="menu-btn" onclick="toggleMenu()">☰ 메뉴</button>
                <div class="menu-dropdown" id="menuDropdown">
                    <div class="menu-item active" onclick="switchTab('vocabulary', this)">단어장</div>
                    <div class="menu-item" onclick="switchTab('word-quiz', this)">단어퀴즈</div>
                    <div class="menu-item" onclick="switchTab('sentence-quiz', this)">문장퀴즈</div>
                    <div class="menu-item" onclick="switchTab('generator', this)">질문생성</div>
                </div>
            </div>
        </div>

        <!-- 오버레이 -->
        <div class="overlay" id="overlay" onclick="closeMenu()"></div>

        <div class="main-content">
            <!-- 단어장 탭 -->
            <div id="vocabulary" class="tab-content active">
                <h2>인터랙티브 단어장</h2>
                
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="switchMode('study', this)">
                        학습 모드 (<span id="study-count">0</span>)
                    </button>
                    <button class="mode-btn" onclick="switchMode('known', this)">
                        아는 단어 (<span id="known-count">0</span>)
                    </button>
                </div>

                <div id="study-mode">
                    <select class="filter-dropdown" id="categoryFilter" onchange="filterCategory()">
                        <option value="all">전체 보기</option>
                        <option value="명사">명사</option>
                        <option value="동사">동사</option>
                        <option value="い형용사">い형용사</option>
                        <option value="な형용사">な형용사</option>
                        <option value="부사">부사</option>
                        <option value="숫자">숫자</option>
                    </select>

                    <div class="interactive-vocab-list" id="vocab-list"></div>
                </div>

                <div id="known-mode" class="hidden">
                    <button class="action-btn" onclick="restoreAll()">모든 단어 되돌리기</button>
                    <div class="known-words-grid" id="known-list"></div>
                </div>
            </div>

            <!-- 단어 퀴즈 탭 -->
            <div id="word-quiz" class="tab-content">
                <h2>단어퀴즈</h2>
                <div class="quiz-section">
                    <div class="quiz-progress-bar">
                        <div id="word-quiz-progress" class="quiz-progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="word-quiz-area">
                        <div class="quiz-card">
                            <p style="text-align: center; font-size: 1rem; color: #666; margin-bottom: 20px;">
                                단어 실력을 테스트해보세요!<br>총 10문제가 출제됩니다.
                            </p>
                            <button class="action-btn" onclick="startWordQuiz()">퀴즈 시작</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 문장 퀴즈 탭 -->
            <div id="sentence-quiz" class="tab-content">
                <h2>문장퀴즈</h2>
                <div class="quiz-section">
                    <div class="quiz-progress-bar">
                        <div id="sentence-quiz-progress" class="quiz-progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="sentence-quiz-area">
                        <div class="quiz-card">
                            <p style="text-align: center; font-size: 1rem; color: #666; margin-bottom: 20px;">
                                문장 실력을 테스트해보세요!<br>총 10문제가 출제됩니다.
                            </p>
                            <button class="action-btn" onclick="startSentenceQuiz()">퀴즈 시작</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 질문 생성기 탭 -->
            <div id="generator" class="tab-content">
                <h2>질문 생성기</h2>
                
                <div class="generator-section">
                    <label style="font-size: 0.9rem; color: #6b7280; margin-bottom: 8px; display: block;">
                        주차별 카테고리
                    </label>
                    <select class="filter-dropdown" id="questionCategory">
                        <option value="">카테고리를 선택하세요</option>
                        <option value="5/11 존댓말과 반말">5/11 존댓말과 반말</option>
                        <option value="5/18 인칭대명사">5/18 인칭대명사</option>
                        <option value="5/25 숫자">5/25 숫자</option>
                        <option value="6/1 동사와 음식">6/1 동사와 음식</option>
                        <option value="6/8 동사+たい">6/8 동사+たい</option>
                        <option value="6/15 있다/없다와 장소">6/15 있다/없다와 장소</option>
                        <option value="6/29 형용사">6/29 형용사</option>
                        <option value="7/6 동사 활용">7/6 동사 활용</option>
                        <option value="7/20 できる 표현">7/20 できる 표현</option>
                        <option value="7/27 의문사">7/27 의문사</option>
                        <option value="8/10 시간 표현">8/10 시간 표현</option>
                        <option value="8/17 교통과 시간">8/17 교통과 시간</option>
                        <option value="기타 N3">기타 N3</option>
                    </select>
                    <button class="generate-btn generate-btn-primary" onclick="generateCategoryQuestion()">
                        카테고리에서 생성
                    </button>
                </div>

                <div class="generator-section">
                    <label style="font-size: 0.9rem; color: #6b7280; margin-bottom: 8px; display: block;">
                        전체 랜덤
                    </label>
                    <button class="generate-btn generate-btn-secondary" onclick="generateRandomQuestion()">
                        랜덤 의문문 생성
                    </button>
                </div>

                <div id="generated-question"></div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let knownWords = JSON.parse(localStorage.getItem('knownWords') || '[]');
        let wordStates = {};
        let currentMode = 'study';
        let currentCategory = 'all';
        let currentTab = 'vocabulary';
        let quizData = [];
        let currentQuizIndex = 0;
        let currentScore = 0;
        let isAnswered = false;

        // 단어 데이터
        const vocabularyData = {
            '명사': [
                { jp: 'これ', kr: '이것', furigana: null },
                { jp: 'それ', kr: '그것', furigana: null },
                { jp: 'あれ', kr: '저것', furigana: null },
                { jp: '私', kr: '저/나', furigana: 'わたし' },
                { jp: '君', kr: '너', furigana: 'きみ' },
                { jp: '本', kr: '책', furigana: 'ほん' },
                { jp: '机', kr: '책상', furigana: 'つくえ' },
                { jp: '椅子', kr: '의자', furigana: 'いす' },
                { jp: '時計', kr: '시계', furigana: 'とけい' },
                { jp: '電車', kr: '전철', furigana: 'でんしゃ' },
                { jp: '学校', kr: '학교', furigana: 'がっこう' },
                { jp: '会社', kr: '회사', furigana: 'かいしゃ' },
                { jp: '家', kr: '집', furigana: 'いえ' },
                { jp: '駅', kr: '역', furigana: 'えき' },
                { jp: '病院', kr: '병원', furigana: 'びょういん' }
            ],
            '동사': [
                { jp: '食べる', kr: '먹다', furigana: 'たべる' },
                { jp: '飲む', kr: '마시다', furigana: 'のむ' },
                { jp: '見る', kr: '보다', furigana: 'みる' },
                { jp: '行く', kr: '가다', furigana: 'いく' },
                { jp: '来る', kr: '오다', furigana: 'くる' },
                { jp: '読む', kr: '읽다', furigana: 'よむ' },
                { jp: '書く', kr: '쓰다', furigana: 'かく' },
                { jp: '話す', kr: '말하다', furigana: 'はなす' },
                { jp: '聞く', kr: '듣다', furigana: 'きく' },
                { jp: '作る', kr: '만들다', furigana: 'つくる' },
                { jp: '買う', kr: '사다', furigana: 'かう' },
                { jp: '売る', kr: '팔다', furigana: 'うる' },
                { jp: '寝る', kr: '자다', furigana: 'ねる' },
                { jp: '起きる', kr: '일어나다', furigana: 'おきる' },
                { jp: '歩く', kr: '걷다', furigana: 'あるく' }
            ],
            'い형용사': [
                { jp: '美味しい', kr: '맛있다', furigana: 'おいしい' },
                { jp: '楽しい', kr: '즐겁다', furigana: 'たのしい' },
                { jp: '新しい', kr: '새롭다', furigana: 'あたらしい' },
                { jp: '古い', kr: '오래되다', furigana: 'ふるい' },
                { jp: '高い', kr: '높다/비싸다', furigana: 'たかい' },
                { jp: '安い', kr: '싸다', furigana: 'やすい' },
                { jp: '大きい', kr: '크다', furigana: 'おおきい' },
                { jp: '小さい', kr: '작다', furigana: 'ちいさい' },
                { jp: '暑い', kr: '덥다', furigana: 'あつい' },
                { jp: '寒い', kr: '춥다', furigana: 'さむい' }
            ],
            'な형용사': [
                { jp: '好き', kr: '좋아하다', furigana: 'すき' },
                { jp: '嫌い', kr: '싫어하다', furigana: 'きらい' },
                { jp: '静か', kr: '조용하다', furigana: 'しずか' },
                { jp: '便利', kr: '편리하다', furigana: 'べんり' },
                { jp: '元気', kr: '건강하다', furigana: 'げんき' },
                { jp: '有名', kr: '유명하다', furigana: 'ゆうめい' },
                { jp: '大切', kr: '소중하다', furigana: 'たいせつ' },
                { jp: '簡単', kr: '간단하다', furigana: 'かんたん' }
            ],
            '부사': [
                { jp: 'とても', kr: '매우', furigana: null },
                { jp: 'ちょっと', kr: '조금', furigana: null },
                { jp: 'もう', kr: '벌써/이제', furigana: null },
                { jp: 'まだ', kr: '아직', furigana: null },
                { jp: 'よく', kr: '자주/잘', furigana: null },
                { jp: 'いつも', kr: '항상', furigana: null },
                { jp: 'たくさん', kr: '많이', furigana: null }
            ],
            '숫자': [
                { jp: '一', kr: '1', furigana: 'いち' },
                { jp: '二', kr: '2', furigana: 'に' },
                { jp: '三', kr: '3', furigana: 'さん' },
                { jp: '四', kr: '4', furigana: 'よん' },
                { jp: '五', kr: '5', furigana: 'ご' },
                { jp: '六', kr: '6', furigana: 'ろく' },
                { jp: '七', kr: '7', furigana: 'なな' },
                { jp: '八', kr: '8', furigana: 'はち' },
                { jp: '九', kr: '9', furigana: 'きゅう' },
                { jp: '十', kr: '10', furigana: 'じゅう' }
            ]
        };

        // 문장 데이터 (질문 포함)
        const sentenceData = {
            '5/11 존댓말과 반말': [
                { jp: 'これは本ですか？', kr: '이것은 책입니까?' },
                { jp: 'これは本なの？', kr: '이것은 책이야?' }
            ],
            '6/1 동사와 음식': [
                { jp: '何を飲みますか？', kr: '뭘 마시겠습니까?' },
                { jp: 'お勧めは何ですか？', kr: '추천하는 것은 무엇인가요?' },
                { jp: 'これは辛いですか？', kr: '이것은 맵나요?' }
            ],
            '7/27 의문사': [
                { jp: 'どうしたんですか？', kr: '무슨 일이세요?' },
                { jp: '今日は何をしますか？', kr: '오늘은 무엇을 하시나요?' },
                { jp: 'どこが痛いですか？', kr: '어디가 아프세요?' }
            ],
            '8/10 시간 표현': [
                { jp: '今何時ですか？', kr: '지금 몇 시입니까?' },
                { jp: '何時に会いましょうか？', kr: '몇 시에 만날까요?' }
            ],
            '기타 N3': [
                { jp: '日本語が話せますか？', kr: '일본어를 할 수 있나요?' },
                { jp: 'カードで払えますか？', kr: '카드로 결제할 수 있나요?' },
                { jp: '返品できますか？', kr: '반품할 수 있나요?' }
            ]
        };

        // 메뉴 토글
        function toggleMenu() {
            const dropdown = document.getElementById('menuDropdown');
            const overlay = document.getElementById('overlay');
            dropdown.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        function closeMenu() {
            const dropdown = document.getElementById('menuDropdown');
            const overlay = document.getElementById('overlay');
            dropdown.classList.remove('show');
            overlay.classList.remove('show');
        }

        // 탭 전환
        function switchTab(tab, element) {
            currentTab = tab;
            
            // 모든 탭 숨기기
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            
            // 메뉴 아이템 활성화
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            element.classList.add('active');
            
            // 메뉴 닫기
            closeMenu();
        }

        // 모드 전환
        function switchMode(mode, element) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');

            if (mode === 'study') {
                document.getElementById('study-mode').classList.remove('hidden');
                document.getElementById('known-mode').classList.add('hidden');
                renderStudyWords();
            } else {
                document.getElementById('study-mode').classList.add('hidden');
                document.getElementById('known-mode').classList.remove('hidden');
                renderKnownWords();
            }
        }

        // 카테고리 필터
        function filterCategory() {
            currentCategory = document.getElementById('categoryFilter').value;
            renderStudyWords();
        }

        // 단어 관련 함수들
        function getAllWords() {
            let words = [];
            if (currentCategory === 'all') {
                Object.keys(vocabularyData).forEach(cat => {
                    vocabularyData[cat].forEach(word => {
                        words.push({ ...word, category: cat });
                    });
                });
            } else {
                vocabularyData[currentCategory]?.forEach(word => {
                    words.push({ ...word, category: currentCategory });
                });
            }
            return words;
        }

        function getStudyWords() {
            const allWords = getAllWords();
            return allWords.filter(word => 
                !knownWords.find(kw => kw.jp === word.jp && kw.kr === word.kr)
            );
        }

        function updateCounts() {
            document.getElementById('study-count').textContent = getStudyWords().length;
            document.getElementById('known-count').textContent = knownWords.length;
        }

        function toggleFurigana(wordId) {
            wordStates[wordId] = wordStates[wordId] || {};
            wordStates[wordId].showFurigana = !wordStates[wordId].showFurigana;
            renderStudyWords();
        }

        function toggleMeaning(wordId) {
            wordStates[wordId] = wordStates[wordId] || {};
            wordStates[wordId].showMeaning = !wordStates[wordId].showMeaning;
            renderStudyWords();
        }

        function markAsKnown(word) {
            knownWords.push(word);
            localStorage.setItem('knownWords', JSON.stringify(knownWords));
            renderStudyWords();
            updateCounts();
        }

        function markAsDontKnow(wordId) {
            wordStates[wordId] = wordStates[wordId] || {};
            wordStates[wordId].checked = true;
            renderStudyWords();
        }

        function restoreWord(word) {
            knownWords = knownWords.filter(kw => 
                !(kw.jp === word.jp && kw.kr === word.kr)
            );
            localStorage.setItem('knownWords', JSON.stringify(knownWords));
            renderKnownWords();
            updateCounts();
        }

        function restoreAll() {
            if (confirm('모든 아는 단어를 되돌리시겠습니까?')) {
                knownWords = [];
                wordStates = {};
                localStorage.setItem('knownWords', JSON.stringify(knownWords));
                renderKnownWords();
                renderStudyWords();
                updateCounts();
            }
        }

        function renderStudyWords() {
            const container = document.getElementById('vocab-list');
            const words = getStudyWords();
            
            if (words.length === 0) {
                container.innerHTML = '<div class="empty-message">모든 단어를 학습했습니다!</div>';
                return;
            }

            container.innerHTML = words.map((word, idx) => {
                const wordId = `${word.jp}_${idx}`;
                const state = wordStates[wordId] || {};
                const hasKanji = /[一-龯]/.test(word.jp);
                
                let japaneseHtml = word.jp;
                if (state.showFurigana && word.furigana && hasKanji) {
                    japaneseHtml = `<ruby>${word.jp}<rt>${word.furigana}</rt></ruby>`;
                }

                return `
                    <div class="interactive-word-card">
                        <div class="word-column">
                            <div class="japanese-word">${japaneseHtml}</div>
                            ${state.showMeaning ? `<div class="word-meaning">${word.kr}</div>` : ''}
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn-small ${state.showFurigana ? 'active' : ''}" 
                                onclick="toggleFurigana('${wordId}')"
                                ${!hasKanji || !word.furigana ? 'disabled' : ''}>あ</button>
                            <button class="action-btn-small ${state.showMeaning ? 'active' : ''}" 
                                onclick="toggleMeaning('${wordId}')">뜻</button>
                            <button class="action-btn-small btn-know" 
                                onclick='markAsKnown(${JSON.stringify(word).replace(/'/g, "\\'")})'>안다</button>
                            <button class="action-btn-small btn-dont-know ${state.checked ? 'checked' : ''}" 
                                onclick="markAsDontKnow('${wordId}')">모른다</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderKnownWords() {
            const container = document.getElementById('known-list');
            
            if (knownWords.length === 0) {
                container.innerHTML = '<div class="empty-message">아직 학습한 단어가 없습니다.</div>';
                return;
            }

            container.innerHTML = knownWords.map(word => `
                <div class="known-word-card" onclick='restoreWord(${JSON.stringify(word).replace(/'/g, "\\'")})'>
                    <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 5px;">${word.jp}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">${word.kr}</div>
                    <div style="font-size: 0.7rem; opacity: 0.7; margin-top: 5px;">탭하여 복원</div>
                </div>
            `).join('');
        }

        // 단어 퀴즈 함수
        function startWordQuiz() {
            const allWords = [];
            Object.keys(vocabularyData).forEach(category => {
                vocabularyData[category].forEach(word => {
                    allWords.push(word);
                });
            });

            // 퀴즈 데이터 생성
            quizData = [];
            const usedIndices = [];
            
            for (let i = 0; i < Math.min(10, allWords.length); i++) {
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * allWords.length);
                } while (usedIndices.includes(randomIndex));
                
                usedIndices.push(randomIndex);
                const word = allWords[randomIndex];
                
                // 오답 선택지 생성
                const wrongAnswers = [];
                while (wrongAnswers.length < 3) {
                    const wrongIndex = Math.floor(Math.random() * allWords.length);
                    if (wrongIndex !== randomIndex && !wrongAnswers.includes(allWords[wrongIndex].kr)) {
                        wrongAnswers.push(allWords[wrongIndex].kr);
                    }
                }
                
                const options = [word.kr, ...wrongAnswers].sort(() => Math.random() - 0.5);
                
                quizData.push({
                    question: word.jp,
                    correct: word.kr,
                    options: options
                });
            }

            currentQuizIndex = 0;
            currentScore = 0;
            showWordQuizQuestion();
        }

        function showWordQuizQuestion() {
            if (currentQuizIndex >= quizData.length) {
                showQuizResult('word');
                return;
            }

            const progress = ((currentQuizIndex + 1) / quizData.length) * 100;
            document.getElementById('word-quiz-progress').style.width = progress + '%';

            const question = quizData[currentQuizIndex];
            isAnswered = false;

            document.getElementById('word-quiz-area').innerHTML = `
                <div class="quiz-card">
                    <div class="quiz-question">"${question.question}"의 뜻은?</div>
                    <div class="quiz-options">
                        ${question.options.map(option => `
                            <button class="quiz-option" onclick="checkWordAnswer('${option.replace(/'/g, "\\'")}')">${option}</button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function checkWordAnswer(answer) {
            if (isAnswered) return;
            isAnswered = true;

            const correct = quizData[currentQuizIndex].correct;
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach(btn => {
                if (btn.textContent === correct) {
                    btn.classList.add('correct');
                } else if (btn.textContent === answer && answer !== correct) {
                    btn.classList.add('wrong');
                }
                btn.style.pointerEvents = 'none';
            });

            if (answer === correct) {
                currentScore++;
            }

            setTimeout(() => {
                currentQuizIndex++;
                showWordQuizQuestion();
            }, 1500);
        }

        // 문장 퀴즈 함수
        function startSentenceQuiz() {
            alert('문장 퀴즈 기능 준비 중입니다.');
        }

        // 질문 생성 함수
        function generateCategoryQuestion() {
            const category = document.getElementById('questionCategory').value;
            if (!category) {
                alert('카테고리를 선택해주세요.');
                return;
            }

            const questions = sentenceData[category] || [];
            if (questions.length === 0) {
                alert('선택한 카테고리에 질문이 없습니다.');
                return;
            }

            const randomIndex = Math.floor(Math.random() * questions.length);
            const question = questions[randomIndex];

            document.getElementById('generated-question').innerHTML = `
                <div class="question-card-single">
                    <div class="question-japanese">${question.jp}</div>
                    <div class="question-korean">${question.kr}</div>
                    <button class="action-btn" onclick="copyText('${question.jp.replace(/'/g, "\\'")}')">복사하기</button>
                </div>
            `;
        }

        function generateRandomQuestion() {
            const allQuestions = [];
            Object.values(sentenceData).forEach(questions => {
                allQuestions.push(...questions);
            });

            if (allQuestions.length === 0) {
                alert('질문이 없습니다.');
                return;
            }

            const randomIndex = Math.floor(Math.random() * allQuestions.length);
            const question = allQuestions[randomIndex];

            document.getElementById('generated-question').innerHTML = `
                <div class="question-card-single">
                    <div class="question-japanese">${question.jp}</div>
                    <div class="question-korean">${question.kr}</div>
                    <button class="action-btn" onclick="copyText('${question.jp.replace(/'/g, "\\'")}')">복사하기</button>
                </div>
            `;
        }

        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                event.target.textContent = '✓ 복사됨';
                setTimeout(() => {
                    event.target.textContent = '복사하기';
                }, 1500);
            });
        }

        function showQuizResult(type) {
            const percentage = (currentScore / quizData.length) * 100;
            let grade = 'D';
            if (percentage >= 90) grade = 'S';
            else if (percentage >= 80) grade = 'A';
            else if (percentage >= 70) grade = 'B';
            else if (percentage >= 60) grade = 'C';

            const areaId = type === 'word' ? 'word-quiz-area' : 'sentence-quiz-area';
            document.getElementById(areaId).innerHTML = `
                <div class="quiz-card">
                    <h3 style="text-align: center; margin-bottom: 20px;">퀴즈 완료!</h3>
                    <div style="text-align: center; font-size: 1.3rem; margin-bottom: 20px;">
                        점수: ${currentScore}/${quizData.length} (${percentage.toFixed(1)}%)
                    </div>
                    <div style="text-align: center; font-size: 2rem; font-weight: bold; color: #7c3aed;">
                        등급: ${grade}
                    </div>
                    <button class="action-btn" onclick="${type === 'word' ? 'startWordQuiz' : 'startSentenceQuiz'}()">다시 도전</button>
                </div>
            `;
        }

        // 초기화
        updateCounts();
        renderStudyWords();
    </script>
</body>
</html>