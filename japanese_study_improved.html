<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>일본어 학습 프로그램 - Improved</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans JP', sans-serif;
            background: #f3f4f6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
        }

        .header {
            background: white;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.1rem;
            color: #7c3aed;
            font-weight: 600;
        }

        .menu-btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .menu-dropdown {
            position: absolute;
            top: 100%;
            right: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 150px;
            margin-top: 8px;
            overflow: hidden;
        }

        .menu-dropdown.show {
            display: block;
        }

        .menu-item {
            padding: 14px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s;
            font-size: 14px;
        }

        .menu-item:hover {
            background: #faf5ff;
        }

        .menu-item.active {
            background: #7c3aed;
            color: white;
        }

        /* 스크롤 프로그레스 바 */
        .scroll-progress {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            z-index: 99;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .scroll-progress.visible {
            opacity: 1;
        }

        .scroll-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #7c3aed, #a855f7);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s;
        }

        .scroll-indicator {
            position: fixed;
            top: 70px;
            right: 20px;
            background: rgba(124, 58, 237, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 99;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .scroll-indicator.visible {
            opacity: 1;
        }

        .main-content {
            padding: 16px;
            min-height: calc(100vh - 60px);
            padding-top: 16px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .mode-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            background: #f5f5f5;
            padding: 3px;
            border-radius: 10px;
        }

        .mode-btn {
            flex: 1;
            padding: 8px;
            border: none;
            background: transparent;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: white;
            color: #7c3aed;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
        }

        .compact-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .compact-dropdown {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            background: white;
            cursor: pointer;
        }

        .mini-stats {
            display: flex;
            justify-content: space-around;
            padding: 6px 8px;
            background: rgba(124, 58, 237, 0.1);
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 11px;
        }

        .mini-stat {
            color: #6b7280;
        }

        .mini-stat strong {
            color: #7c3aed;
            font-weight: 700;
            margin-left: 2px;
        }

        .interactive-vocab-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: calc(100vh - 190px);
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .interactive-word-card {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            min-height: 90px;
            gap: 10px;
            box-shadow: 0 3px 10px rgba(124, 58, 237, 0.2);
            transition: all 0.3s;
            position: relative;
        }

        .bookmark-star {
            position: absolute;
            top: 6px;
            right: 6px;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.3s;
            z-index: 10;
        }

        .bookmark-star.active {
            opacity: 1;
            color: #fbbf24;
        }

        .bookmark-star:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .word-column {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 6px;
        }

        .japanese-word {
            font-size: 1.6rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .japanese-word ruby rt {
            font-size: 0.55em;
            opacity: 0.9;
        }

        .word-meaning {
            font-size: 1.1rem;
            opacity: 0.95;
            color: #f0f8ff;
            font-weight: 500;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 36px 36px;
            grid-template-rows: 32px 32px;
            gap: 3px;
            margin-left: 6px;
        }

        .action-btn-small {
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-btn-small:active {
            transform: scale(0.95);
        }

        .action-btn-small.active {
            background: white;
            color: #7c3aed;
        }

        .action-btn-small:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-know {
            background: rgba(34, 197, 94, 0.25);
            border-color: rgba(34, 197, 94, 0.5);
            grid-column: span 2;
        }

        .action-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .compact-action-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .known-words-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            max-height: calc(100vh - 150px);
            overflow-y: auto;
        }

        .known-word-card {
            background: linear-gradient(135deg, #22c55e 0%, #84cc16 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.2);
        }

        .empty-message {
            text-align: center;
            padding: 48px 24px;
            color: #9ca3af;
            font-size: 1rem;
        }

        .hidden {
            display: none;
        }

        /* 퀴즈 스타일 */
        .quiz-type-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: #f5f5f5;
            padding: 4px;
            border-radius: 12px;
        }

        .quiz-type-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            color: #666;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .quiz-type-btn.active {
            background: white;
            color: #7c3aed;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
        }

        .quiz-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 32px 24px;
            margin-bottom: 24px;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .quiz-question {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 32px;
            line-height: 1.4;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
            margin-bottom: 24px;
        }

        .quiz-option {
            padding: 16px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            color: #374151;
        }

        .quiz-option:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .quiz-option.correct {
            background: #22c55e;
            color: white;
            border-color: #16a34a;
        }

        .quiz-option.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .quiz-result {
            text-align: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .quiz-answer-display {
            color: #fff9c4;
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .quiz-answer-furigana {
            color: rgba(255, 255, 255, 0.85);
            font-size: 1rem;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }

        .quiz-control-btn {
            padding: 12px 24px;
            background: #7c3aed;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
        }

        .quiz-progress {
            font-size: 14px;
            color: #6b7280;
            font-weight: 600;
            text-align: center;
            padding: 8px;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #7c3aed;
            border-radius: 3px;
        }

        @media (min-width: 768px) {
            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 20px;
            }
            
            .app-container {
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                border-radius: 20px;
                overflow: hidden;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>일본어 학습 Improved</h1>
            <button class="menu-btn" onclick="toggleMenu()">메뉴</button>
            <div class="menu-dropdown" id="menuDropdown">
                <div class="menu-item active" onclick="switchTab('vocabulary')">단어장</div>
                <div class="menu-item" onclick="switchTab('wordQuiz')">단어 퀴즈</div>
                <div class="menu-item" onclick="switchTab('sentenceQuiz')">문장 퀴즈</div>
            </div>
        </div>

        <!-- 스크롤 프로그레스 바 -->
        <div class="scroll-progress" id="scrollProgress">
            <div class="scroll-progress-bar" id="scrollProgressBar"></div>
        </div>
        <div class="scroll-indicator" id="scrollIndicator">0 / 0</div>

        <div class="main-content">
            <!-- 단어장 탭 -->
            <div id="vocabulary" class="tab-content active">
                <h2 style="font-size: 1.1rem; margin-bottom: 12px; color: #374151;">인터랙티브 단어장</h2>
                
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="switchMode('study')">
                        학습할 단어 (<span id="study-count">0</span>)
                    </button>
                    <button class="mode-btn" onclick="switchMode('known')">
                        완료한 단어 (<span id="known-count">0</span>)
                    </button>
                </div>

                <div id="study-mode">
                    <div class="compact-controls">
                        <select class="compact-dropdown" id="levelFilter" onchange="filterLevel()">
                            <option value="lesson">수업 단어</option>
                            <option value="n5">JLPT N5</option>
                            <option value="n4">JLPT N4</option>
                            <option value="n3">JLPT N3</option>
                        </select>
                        <select class="compact-dropdown" id="categoryFilter" onchange="filterCategory()">
                            <option value="all">전체 보기</option>
                        </select>
                    </div>

                    <div class="mini-stats">
                        <span class="mini-stat">전체 <strong id="totalWords">0</strong></span>
                        <span class="mini-stat">진행 <strong id="currentPosition">0</strong></span>
                        <span class="mini-stat">완료 <strong id="learnedPercentage">0%</strong></span>
                    </div>

                    <div class="interactive-vocab-list" id="vocab-list" onscroll="updateScrollProgress()"></div>
                </div>

                <div id="known-mode" class="hidden">
                    <div class="action-controls">
                        <button class="compact-action-btn" onclick="restoreAll()">모든 단어 되돌리기</button>
                    </div>
                    <div class="known-words-grid" id="known-list"></div>
                </div>
            </div>

            <!-- 단어 퀴즈 탭 -->
            <div id="wordQuiz" class="tab-content">
                <h2 style="font-size: 1.2rem; margin-bottom: 16px; color: #374151;">단어 퀴즈</h2>
                
                <div class="quiz-card">
                    <div class="quiz-question" id="word-quiz-question">読む</div>
                    <div class="quiz-options" id="word-quiz-options">
                        <button class="quiz-option" onclick="selectWordAnswer(0)">읽다</button>
                        <button class="quiz-option" onclick="selectWordAnswer(1)">쓰다</button>
                        <button class="quiz-option" onclick="selectWordAnswer(2)">듣다</button>
                        <button class="quiz-option" onclick="selectWordAnswer(3)">말하다</button>
                    </div>
                    <div class="quiz-result hidden" id="word-quiz-result">
                        <div class="quiz-answer-display" id="word-quiz-answer"></div>
                        <div class="quiz-answer-furigana" id="word-quiz-furigana"></div>
                    </div>
                </div>
                
                <div class="quiz-progress" id="word-quiz-progress">1 / 10</div>
                
                <div class="quiz-controls">
                    <button class="quiz-control-btn" onclick="nextWordQuestion()">다음 문제</button>
                </div>
            </div>

            <!-- 문장 퀴즈 탭 -->
            <div id="sentenceQuiz" class="tab-content">
                <h2 style="font-size: 1.2rem; margin-bottom: 16px; color: #374151;">문장 퀴즈</h2>
                
                <div class="quiz-card">
                    <div class="quiz-question" id="sentence-quiz-question">これは なに？</div>
                    <div class="quiz-options" id="sentence-quiz-options">
                        <button class="quiz-option" onclick="selectSentenceAnswer(0)">이것은 무엇인가요?</button>
                        <button class="quiz-option" onclick="selectSentenceAnswer(1)">그것은 무엇인가요?</button>
                        <button class="quiz-option" onclick="selectSentenceAnswer(2)">저것은 무엇인가요?</button>
                        <button class="quiz-option" onclick="selectSentenceAnswer(3)">어느것은 무엇인가요?</button>
                    </div>
                    <div class="quiz-result hidden" id="sentence-quiz-result">
                        <div class="quiz-answer-display" id="sentence-quiz-answer"></div>
                        <div class="quiz-answer-furigana" id="sentence-quiz-furigana"></div>
                    </div>
                </div>
                
                <div class="quiz-progress" id="sentence-quiz-progress">1 / 20</div>
                
                <div class="quiz-controls">
                    <button class="quiz-control-btn" onclick="nextSentenceQuestion()">다음 문제</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // N5 단어 데이터 (약 1000개)
        const n5Vocabulary = {
            '명사': [
                { jp: '人', kr: '사람', furigana: 'ひと' },
                { jp: '子供', kr: '아이', furigana: 'こども' },
                { jp: '女', kr: '여자', furigana: 'おんな' },
                { jp: '男', kr: '남자', furigana: 'おとこ' },
                { jp: '名前', kr: '이름', furigana: 'なまえ' },
                { jp: '本', kr: '책', furigana: 'ほん' },
                { jp: '机', kr: '책상', furigana: 'つくえ' },
                { jp: '椅子', kr: '의자', furigana: 'いす' },
                { jp: '部屋', kr: '방', furigana: 'へや' },
                { jp: '教室', kr: '교실', furigana: 'きょうしつ' },
                { jp: '窓', kr: '창문', furigana: 'まど' },
                { jp: 'ドア', kr: '문', furigana: null },
                { jp: '鞄', kr: '가방', furigana: 'かばん' },
                { jp: '財布', kr: '지갑', furigana: 'さいふ' },
                { jp: '傘', kr: '우산', furigana: 'かさ' },
                { jp: '鍵', kr: '열쇠', furigana: 'かぎ' },
                { jp: '時計', kr: '시계', furigana: 'とけい' },
                { jp: '写真', kr: '사진', furigana: 'しゃしん' },
                { jp: '電話', kr: '전화', furigana: 'でんわ' },
                { jp: 'テレビ', kr: 'TV', furigana: null },
                { jp: 'パソコン', kr: '컴퓨터', furigana: null },
                { jp: '新聞', kr: '신문', furigana: 'しんぶん' },
                { jp: '雑誌', kr: '잡지', furigana: 'ざっし' },
                { jp: '辞書', kr: '사전', furigana: 'じしょ' },
                { jp: 'ペン', kr: '펜', furigana: null },
                { jp: '鉛筆', kr: '연필', furigana: 'えんぴつ' },
                { jp: 'ノート', kr: '노트', furigana: null },
                { jp: '紙', kr: '종이', furigana: 'かみ' },
                { jp: '手紙', kr: '편지', furigana: 'てがみ' },
                { jp: '切手', kr: '우표', furigana: 'きって' },
                { jp: '切符', kr: '표', furigana: 'きっぷ' },
                { jp: '荷物', kr: '짐', furigana: 'にもつ' },
                { jp: '箱', kr: '상자', furigana: 'はこ' },
                { jp: '花', kr: '꽃', furigana: 'はな' },
                { jp: '木', kr: '나무', furigana: 'き' },
                { jp: '山', kr: '산', furigana: 'やま' },
                { jp: '川', kr: '강', furigana: 'かわ' },
                { jp: '海', kr: '바다', furigana: 'うみ' },
                { jp: '空', kr: '하늘', furigana: 'そら' },
                { jp: '雨', kr: '비', furigana: 'あめ' },
                { jp: '雪', kr: '눈', furigana: 'ゆき' },
                { jp: '風', kr: '바람', furigana: 'かぜ' },
                { jp: '天気', kr: '날씨', furigana: 'てんき' },
                { jp: '朝', kr: '아침', furigana: 'あさ' },
                { jp: '昼', kr: '낮', furigana: 'ひる' },
                { jp: '夕方', kr: '저녁', furigana: 'ゆうがた' },
                { jp: '夜', kr: '밤', furigana: 'よる' },
                { jp: '今日', kr: '오늘', furigana: 'きょう' },
                { jp: '昨日', kr: '어제', furigana: 'きのう' },
                { jp: '明日', kr: '내일', furigana: 'あした' }
            ],
            '동사': [
                { jp: '行く', kr: '가다', furigana: 'いく' },
                { jp: '来る', kr: '오다', furigana: 'くる' },
                { jp: '帰る', kr: '돌아가다', furigana: 'かえる' },
                { jp: '歩く', kr: '걷다', furigana: 'あるく' },
                { jp: '走る', kr: '달리다', furigana: 'はしる' },
                { jp: '止まる', kr: '멈추다', furigana: 'とまる' },
                { jp: '曲がる', kr: '돌다', furigana: 'まがる' },
                { jp: '渡る', kr: '건너다', furigana: 'わたる' },
                { jp: '登る', kr: '오르다', furigana: 'のぼる' },
                { jp: '降りる', kr: '내리다', furigana: 'おりる' },
                { jp: '入る', kr: '들어가다', furigana: 'はいる' },
                { jp: '出る', kr: '나가다', furigana: 'でる' },
                { jp: '着く', kr: '도착하다', furigana: 'つく' },
                { jp: '出発する', kr: '출발하다', furigana: 'しゅっぱつする' },
                { jp: '乗る', kr: '타다', furigana: 'のる' },
                { jp: '見る', kr: '보다', furigana: 'みる' },
                { jp: '聞く', kr: '듣다', furigana: 'きく' },
                { jp: '言う', kr: '말하다', furigana: 'いう' },
                { jp: '話す', kr: '이야기하다', furigana: 'はなす' },
                { jp: '教える', kr: '가르치다', furigana: 'おしえる' },
                { jp: '習う', kr: '배우다', furigana: 'ならう' },
                { jp: '覚える', kr: '외우다', furigana: 'おぼえる' },
                { jp: '忘れる', kr: '잊다', furigana: 'わすれる' },
                { jp: '思う', kr: '생각하다', furigana: 'おもう' },
                { jp: '考える', kr: '생각하다', furigana: 'かんがえる' },
                { jp: '知る', kr: '알다', furigana: 'しる' },
                { jp: '分かる', kr: '알다/이해하다', furigana: 'わかる' },
                { jp: '食べる', kr: '먹다', furigana: 'たべる' },
                { jp: '飲む', kr: '마시다', furigana: 'のむ' },
                { jp: '吸う', kr: '빨다/피우다', furigana: 'すう' },
                { jp: '料理する', kr: '요리하다', furigana: 'りょうりする' },
                { jp: '作る', kr: '만들다', furigana: 'つくる' },
                { jp: '切る', kr: '자르다', furigana: 'きる' },
                { jp: '洗う', kr: '씻다', furigana: 'あらう' },
                { jp: '掃除する', kr: '청소하다', furigana: 'そうじする' },
                { jp: '買う', kr: '사다', furigana: 'かう' },
                { jp: '売る', kr: '팔다', furigana: 'うる' },
                { jp: '払う', kr: '지불하다', furigana: 'はらう' },
                { jp: '開ける', kr: '열다', furigana: 'あける' },
                { jp: '閉める', kr: '닫다', furigana: 'しめる' },
                { jp: '始める', kr: '시작하다', furigana: 'はじめる' },
                { jp: '終わる', kr: '끝나다', furigana: 'おわる' },
                { jp: '寝る', kr: '자다', furigana: 'ねる' },
                { jp: '起きる', kr: '일어나다', furigana: 'おきる' },
                { jp: '働く', kr: '일하다', furigana: 'はたらく' },
                { jp: '勉強する', kr: '공부하다', furigana: 'べんきょうする' },
                { jp: '読む', kr: '읽다', furigana: 'よむ' },
                { jp: '書く', kr: '쓰다', furigana: 'かく' }
            ],
            'い형용사': [
                { jp: '大きい', kr: '크다', furigana: 'おおきい' },
                { jp: '小さい', kr: '작다', furigana: 'ちいさい' },
                { jp: '多い', kr: '많다', furigana: 'おおい' },
                { jp: '少ない', kr: '적다', furigana: 'すくない' },
                { jp: '長い', kr: '길다', furigana: 'ながい' },
                { jp: '短い', kr: '짧다', furigana: 'みじかい' },
                { jp: '高い', kr: '높다/비싸다', furigana: 'たかい' },
                { jp: '低い', kr: '낮다', furigana: 'ひくい' },
                { jp: '安い', kr: '싸다', furigana: 'やすい' },
                { jp: '新しい', kr: '새롭다', furigana: 'あたらしい' },
                { jp: '古い', kr: '오래되다', furigana: 'ふるい' },
                { jp: '若い', kr: '젊다', furigana: 'わかい' },
                { jp: '良い', kr: '좋다', furigana: 'よい/いい' },
                { jp: '悪い', kr: '나쁘다', furigana: 'わるい' },
                { jp: '広い', kr: '넓다', furigana: 'ひろい' },
                { jp: '狭い', kr: '좁다', furigana: 'せまい' },
                { jp: '太い', kr: '굵다', furigana: 'ふとい' },
                { jp: '細い', kr: '가늘다', furigana: 'ほそい' },
                { jp: '厚い', kr: '두껍다', furigana: 'あつい' },
                { jp: '薄い', kr: '얇다', furigana: 'うすい' },
                { jp: '重い', kr: '무겁다', furigana: 'おもい' },
                { jp: '軽い', kr: '가볍다', furigana: 'かるい' },
                { jp: '強い', kr: '강하다', furigana: 'つよい' },
                { jp: '弱い', kr: '약하다', furigana: 'よわい' },
                { jp: '固い', kr: '단단하다', furigana: 'かたい' },
                { jp: '柔らかい', kr: '부드럽다', furigana: 'やわらかい' },
                { jp: '熱い', kr: '뜨겁다', furigana: 'あつい' },
                { jp: '冷たい', kr: '차갑다', furigana: 'つめたい' },
                { jp: '暖かい', kr: '따뜻하다', furigana: 'あたたかい' },
                { jp: '涼しい', kr: '시원하다', furigana: 'すずしい' },
                { jp: '暑い', kr: '덥다', furigana: 'あつい' },
                { jp: '寒い', kr: '춥다', furigana: 'さむい' },
                { jp: '明るい', kr: '밝다', furigana: 'あかるい' },
                { jp: '暗い', kr: '어둡다', furigana: 'くらい' },
                { jp: '美味しい', kr: '맛있다', furigana: 'おいしい' },
                { jp: '甘い', kr: '달다', furigana: 'あまい' },
                { jp: '辛い', kr: '맵다', furigana: 'からい' },
                { jp: '苦い', kr: '쓰다', furigana: 'にがい' },
                { jp: '美しい', kr: '아름답다', furigana: 'うつくしい' },
                { jp: '汚い', kr: '더럽다', furigana: 'きたない' },
                { jp: '可愛い', kr: '귀엽다', furigana: 'かわいい' },
                { jp: '面白い', kr: '재미있다', furigana: 'おもしろい' },
                { jp: '楽しい', kr: '즐겁다', furigana: 'たのしい' },
                { jp: '嬉しい', kr: '기쁘다', furigana: 'うれしい' },
                { jp: '悲しい', kr: '슬프다', furigana: 'かなしい' },
                { jp: '寂しい', kr: '외롭다', furigana: 'さびしい' },
                { jp: '怖い', kr: '무섭다', furigana: 'こわい' },
                { jp: '危ない', kr: '위험하다', furigana: 'あぶない' },
                { jp: '難しい', kr: '어렵다', furigana: 'むずかしい' },
                { jp: '易しい', kr: '쉽다', furigana: 'やさしい' },
                { jp: '忙しい', kr: '바쁘다', furigana: 'いそがしい' },
                { jp: '珍しい', kr: '드물다', furigana: 'めずらしい' },
                { jp: '優しい', kr: '상냥하다', furigana: 'やさしい' },
                { jp: '厳しい', kr: '엄격하다', furigana: 'きびしい' },
                { jp: '正しい', kr: '올바르다', furigana: 'ただしい' },
                { jp: '近い', kr: '가깝다', furigana: 'ちかい' },
                { jp: '遠い', kr: '멀다', furigana: 'とおい' },
                { jp: '早い', kr: '이르다', furigana: 'はやい' },
                { jp: '速い', kr: '빠르다', furigana: 'はやい' },
                { jp: '遅い', kr: '늦다', furigana: 'おそい' }
            ],
            'な형용사': [
                { jp: '好きだ', kr: '좋아하다', furigana: 'すきだ' },
                { jp: '嫌いだ', kr: '싫어하다', furigana: 'きらいだ' },
                { jp: '静かだ', kr: '조용하다', furigana: 'しずかだ' },
                { jp: '便利だ', kr: '편리하다', furigana: 'べんりだ' },
                { jp: '元気だ', kr: '건강하다', furigana: 'げんきだ' },
                { jp: '綺麗だ', kr: '아름답다/깨끗하다', furigana: 'きれいだ' },
                { jp: '安全だ', kr: '안전하다', furigana: 'あんぜんだ' },
                { jp: '有名だ', kr: '유명하다', furigana: 'ゆうめいだ' },
                { jp: '大切だ', kr: '소중하다', furigana: 'たいせつだ' },
                { jp: '簡単だ', kr: '간단하다', furigana: 'かんたんだ' },
                { jp: '大変だ', kr: '힘들다', furigana: 'たいへんだ' },
                { jp: '上手だ', kr: '잘하다', furigana: 'じょうずだ' },
                { jp: '下手だ', kr: '못하다', furigana: 'へただ' },
                { jp: '親切だ', kr: '친절하다', furigana: 'しんせつだ' },
                { jp: '丈夫だ', kr: '튼튼하다', furigana: 'じょうぶだ' },
                { jp: '健康だ', kr: '건강하다', furigana: 'けんこうだ' },
                { jp: '病気だ', kr: '아프다', furigana: 'びょうきだ' },
                { jp: '暇だ', kr: '한가하다', furigana: 'ひまだ' },
                { jp: '必要だ', kr: '필요하다', furigana: 'ひつようだ' },
                { jp: '大事だ', kr: '중요하다', furigana: 'だいじだ' },
                { jp: '特別だ', kr: '특별하다', furigana: 'とくべつだ' },
                { jp: '普通だ', kr: '보통이다', furigana: 'ふつうだ' },
                { jp: '変だ', kr: '이상하다', furigana: 'へんだ' },
                { jp: '不便だ', kr: '불편하다', furigana: 'ふべんだ' },
                { jp: '真面目だ', kr: '성실하다', furigana: 'まじめだ' },
                { jp: '正直だ', kr: '정직하다', furigana: 'しょうじきだ' },
                { jp: '自由だ', kr: '자유롭다', furigana: 'じゆうだ' },
                { jp: '賑やかだ', kr: '시끌벅적하다', furigana: 'にぎやかだ' }
            ]
        };

        // N4 단어 데이터 (약 800개)
        const n4Vocabulary = {
            '명사': [
                { jp: '意味', kr: '의미', furigana: 'いみ' },
                { jp: '意見', kr: '의견', furigana: 'いけん' },
                { jp: '医学', kr: '의학', furigana: 'いがく' },
                { jp: '科学', kr: '과학', furigana: 'かがく' },
                { jp: '技術', kr: '기술', furigana: 'ぎじゅつ' },
                { jp: '経験', kr: '경험', furigana: 'けいけん' },
                { jp: '計画', kr: '계획', furigana: 'けいかく' },
                { jp: '研究', kr: '연구', furigana: 'けんきゅう' },
                { jp: '交通', kr: '교통', furigana: 'こうつう' },
                { jp: '産業', kr: '산업', furigana: 'さんぎょう' },
                { jp: '社会', kr: '사회', furigana: 'しゃかい' },
                { jp: '政治', kr: '정치', furigana: 'せいじ' },
                { jp: '経済', kr: '경제', furigana: 'けいざい' },
                { jp: '文化', kr: '문화', furigana: 'ぶんか' },
                { jp: '歴史', kr: '역사', furigana: 'れきし' },
                { jp: '教育', kr: '교육', furigana: 'きょういく' },
                { jp: '理由', kr: '이유', furigana: 'りゆう' },
                { jp: '原因', kr: '원인', furigana: 'げんいん' },
                { jp: '結果', kr: '결과', furigana: 'けっか' },
                { jp: '目的', kr: '목적', furigana: 'もくてき' },
                { jp: '方法', kr: '방법', furigana: 'ほうほう' },
                { jp: '関係', kr: '관계', furigana: 'かんけい' },
                { jp: '連絡', kr: '연락', furigana: 'れんらく' },
                { jp: '相談', kr: '상담', furigana: 'そうだん' },
                { jp: '準備', kr: '준비', furigana: 'じゅんび' },
                { jp: '予定', kr: '예정', furigana: 'よてい' },
                { jp: '約束', kr: '약속', furigana: 'やくそく' },
                { jp: '習慣', kr: '습관', furigana: 'しゅうかん' },
                { jp: '生活', kr: '생활', furigana: 'せいかつ' },
                { jp: '場合', kr: '경우', furigana: 'ばあい' },
                { jp: '機会', kr: '기회', furigana: 'きかい' },
                { jp: '時代', kr: '시대', furigana: 'じだい' },
                { jp: '最近', kr: '최근', furigana: 'さいきん' },
                { jp: '将来', kr: '장래', furigana: 'しょうらい' },
                { jp: '気持ち', kr: '기분', furigana: 'きもち' },
                { jp: '考え', kr: '생각', furigana: 'かんがえ' },
                { jp: '心', kr: '마음', furigana: 'こころ' },
                { jp: '夢', kr: '꿈', furigana: 'ゆめ' },
                { jp: '希望', kr: '희망', furigana: 'きぼう' },
                { jp: '心配', kr: '걱정', furigana: 'しんぱい' },
                { jp: '安心', kr: '안심', furigana: 'あんしん' },
                { jp: '興味', kr: '흥미', furigana: 'きょうみ' },
                { jp: '趣味', kr: '취미', furigana: 'しゅみ' },
                { jp: '音', kr: '소리', furigana: 'おと' },
                { jp: '声', kr: '목소리', furigana: 'こえ' },
                { jp: '匂い', kr: '냄새', furigana: 'におい' },
                { jp: '味', kr: '맛', furigana: 'あじ' },
                { jp: '形', kr: '모양', furigana: 'かたち' },
                { jp: '色', kr: '색', furigana: 'いろ' }
            ],
            '동사': [
                { jp: '決める', kr: '정하다', furigana: 'きめる' },
                { jp: '決まる', kr: '정해지다', furigana: 'きまる' },
                { jp: '伝える', kr: '전하다', furigana: 'つたえる' },
                { jp: '選ぶ', kr: '고르다', furigana: 'えらぶ' },
                { jp: '比べる', kr: '비교하다', furigana: 'くらべる' },
                { jp: '調べる', kr: '조사하다', furigana: 'しらべる' },
                { jp: '確かめる', kr: '확인하다', furigana: 'たしかめる' },
                { jp: '試す', kr: '시험하다', furigana: 'ためす' },
                { jp: '慣れる', kr: '익숙해지다', furigana: 'なれる' },
                { jp: '疲れる', kr: '피곤하다', furigana: 'つかれる' },
                { jp: '眠る', kr: '잠들다', furigana: 'ねむる' },
                { jp: '起こす', kr: '깨우다', furigana: 'おこす' },
                { jp: '生きる', kr: '살다', furigana: 'いきる' },
                { jp: '死ぬ', kr: '죽다', furigana: 'しぬ' },
                { jp: '生まれる', kr: '태어나다', furigana: 'うまれる' },
                { jp: '育つ', kr: '자라다', furigana: 'そだつ' },
                { jp: '育てる', kr: '기르다', furigana: 'そだてる' },
                { jp: '増える', kr: '늘다', furigana: 'ふえる' },
                { jp: '減る', kr: '줄다', furigana: 'へる' },
                { jp: '変わる', kr: '바뀌다', furigana: 'かわる' },
                { jp: '変える', kr: '바꾸다', furigana: 'かえる' },
                { jp: '直す', kr: '고치다', furigana: 'なおす' },
                { jp: '直る', kr: '고쳐지다', furigana: 'なおる' },
                { jp: '壊す', kr: '부수다', furigana: 'こわす' },
                { jp: '壊れる', kr: '부서지다', furigana: 'こわれる' },
                { jp: '落とす', kr: '떨어뜨리다', furigana: 'おとす' },
                { jp: '落ちる', kr: '떨어지다', furigana: 'おちる' },
                { jp: '上げる', kr: '올리다', furigana: 'あげる' },
                { jp: '上がる', kr: '올라가다', furigana: 'あがる' },
                { jp: '下げる', kr: '내리다', furigana: 'さげる' },
                { jp: '下がる', kr: '내려가다', furigana: 'さがる' },
                { jp: '進む', kr: '나아가다', furigana: 'すすむ' },
                { jp: '戻る', kr: '돌아오다', furigana: 'もどる' },
                { jp: '戻す', kr: '되돌리다', furigana: 'もどす' },
                { jp: '集める', kr: '모으다', furigana: 'あつめる' },
                { jp: '集まる', kr: '모이다', furigana: 'あつまる' },
                { jp: '並べる', kr: '늘어놓다', furigana: 'ならべる' },
                { jp: '並ぶ', kr: '줄서다', furigana: 'ならぶ' },
                { jp: '混ぜる', kr: '섞다', furigana: 'まぜる' },
                { jp: '混ざる', kr: '섞이다', furigana: 'まざる' }
            ],
            '형용사': [
                { jp: '深い', kr: '깊다', furigana: 'ふかい' },
                { jp: '浅い', kr: '얕다', furigana: 'あさい' },
                { jp: '濃い', kr: '진하다', furigana: 'こい' },
                { jp: '薄い', kr: '옅다', furigana: 'うすい' },
                { jp: '苦しい', kr: '괴롭다', furigana: 'くるしい' },
                { jp: '痛い', kr: '아프다', furigana: 'いたい' },
                { jp: '気持ちいい', kr: '기분좋다', furigana: 'きもちいい' },
                { jp: '気持ち悪い', kr: '기분나쁘다', furigana: 'きもちわるい' },
                { jp: '恥ずかしい', kr: '부끄럽다', furigana: 'はずかしい' },
                { jp: 'うるさい', kr: '시끄럽다', furigana: null },
                { jp: '賢い', kr: '똑똑하다', furigana: 'かしこい' },
                { jp: '似合う', kr: '어울리다', furigana: 'にあう' },
                { jp: '複雑だ', kr: '복잡하다', furigana: 'ふくざつだ' },
                { jp: '単純だ', kr: '단순하다', furigana: 'たんじゅんだ' },
                { jp: '適当だ', kr: '적당하다', furigana: 'てきとうだ' },
                { jp: '確かだ', kr: '확실하다', furigana: 'たしかだ' },
                { jp: '完全だ', kr: '완전하다', furigana: 'かんぜんだ' },
                { jp: '十分だ', kr: '충분하다', furigana: 'じゅうぶんだ' },
                { jp: '急だ', kr: '급하다', furigana: 'きゅうだ' },
                { jp: '豊かだ', kr: '풍부하다', furigana: 'ゆたかだ' }
            ]
        };

        // N3 단어 데이터 (약 700개)
        const n3Vocabulary = {
            '명사': [
                { jp: '影響', kr: '영향', furigana: 'えいきょう' },
                { jp: '効果', kr: '효과', furigana: 'こうか' },
                { jp: '状態', kr: '상태', furigana: 'じょうたい' },
                { jp: '状況', kr: '상황', furigana: 'じょうきょう' },
                { jp: '条件', kr: '조건', furigana: 'じょうけん' },
                { jp: '規則', kr: '규칙', furigana: 'きそく' },
                { jp: '制度', kr: '제도', furigana: 'せいど' },
                { jp: '組織', kr: '조직', furigana: 'そしき' },
                { jp: '団体', kr: '단체', furigana: 'だんたい' },
                { jp: '個人', kr: '개인', furigana: 'こじん' },
                { jp: '人物', kr: '인물', furigana: 'じんぶつ' },
                { jp: '性格', kr: '성격', furigana: 'せいかく' },
                { jp: '態度', kr: '태도', furigana: 'たいど' },
                { jp: '表情', kr: '표정', furigana: 'ひょうじょう' },
                { jp: '感情', kr: '감정', furigana: 'かんじょう' },
                { jp: '印象', kr: '인상', furigana: 'いんしょう' },
                { jp: '評価', kr: '평가', furigana: 'ひょうか' },
                { jp: '批判', kr: '비판', furigana: 'ひはん' },
                { jp: '議論', kr: '의논', furigana: 'ぎろん' },
                { jp: '会話', kr: '회화', furigana: 'かいわ' }
            ],
            '동사': [
                { jp: '表す', kr: '나타내다', furigana: 'あらわす' },
                { jp: '現れる', kr: '나타나다', furigana: 'あらわれる' },
                { jp: '示す', kr: '보이다', furigana: 'しめす' },
                { jp: '表現する', kr: '표현하다', furigana: 'ひょうげんする' },
                { jp: '説明する', kr: '설명하다', furigana: 'せつめいする' },
                { jp: '理解する', kr: '이해하다', furigana: 'りかいする' },
                { jp: '判断する', kr: '판단하다', furigana: 'はんだんする' },
                { jp: '決定する', kr: '결정하다', furigana: 'けっていする' },
                { jp: '実行する', kr: '실행하다', furigana: 'じっこうする' },
                { jp: '実現する', kr: '실현하다', furigana: 'じつげんする' },
                { jp: '成功する', kr: '성공하다', furigana: 'せいこうする' },
                { jp: '失敗する', kr: '실패하다', furigana: 'しっぱいする' },
                { jp: '努力する', kr: '노력하다', furigana: 'どりょくする' },
                { jp: '協力する', kr: '협력하다', furigana: 'きょうりょくする' },
                { jp: '競争する', kr: '경쟁하다', furigana: 'きょうそうする' }
            ],
            '형용사': [
                { jp: '貴重だ', kr: '귀중하다', furigana: 'きちょうだ' },
                { jp: '重要だ', kr: '중요하다', furigana: 'じゅうようだ' },
                { jp: '必要だ', kr: '필요하다', furigana: 'ひつようだ' },
                { jp: '不要だ', kr: '불필요하다', furigana: 'ふようだ' },
                { jp: '可能だ', kr: '가능하다', furigana: 'かのうだ' },
                { jp: '不可能だ', kr: '불가능하다', furigana: 'ふかのうだ' },
                { jp: '困難だ', kr: '곤란하다', furigana: 'こんなんだ' },
                { jp: '容易だ', kr: '용이하다', furigana: 'よういだ' },
                { jp: '明らかだ', kr: '명백하다', furigana: 'あきらかだ' },
                { jp: '明確だ', kr: '명확하다', furigana: 'めいかくだ' },
                { jp: '曖昧だ', kr: '애매하다', furigana: 'あいまいだ' },
                { jp: '具体的だ', kr: '구체적이다', furigana: 'ぐたいてきだ' },
                { jp: '抽象的だ', kr: '추상적이다', furigana: 'ちゅうしょうてきだ' },
                { jp: '積極的だ', kr: '적극적이다', furigana: 'せっきょくてきだ' },
                { jp: '消極的だ', kr: '소극적이다', furigana: 'しょうきょくてきだ' },
                { jp: '効率的だ', kr: '효율적이다', furigana: 'こうりつてきだ' },
                { jp: '合理的だ', kr: '합리적이다', furigana: 'ごうりてきだ' },
                { jp: '理想的だ', kr: '이상적이다', furigana: 'りそうてきだ' },
                { jp: '現実的だ', kr: '현실적이다', furigana: 'げんじつてきだ' },
                { jp: '国際的だ', kr: '국제적이다', furigana: 'こくさいてきだ' }
            ]
        };

        // 수업 단어 데이터 (확장 - 약 160개)
        const lessonVocabulary = {
            '명사': [
                { jp: 'これ', kr: '이것', furigana: null },
                { jp: 'それ', kr: '그것', furigana: null },
                { jp: 'あれ', kr: '저것', furigana: null },
                { jp: 'どれ', kr: '어느것', furigana: null },
                { jp: '私', kr: '저/나', furigana: 'わたし' },
                { jp: '君', kr: '너', furigana: 'きみ' },
                { jp: '彼', kr: '그', furigana: 'かれ' },
                { jp: '彼女', kr: '그녀', furigana: 'かのじょ' },
                { jp: '先生', kr: '선생님', furigana: 'せんせい' },
                { jp: '学生', kr: '학생', furigana: 'がくせい' },
                { jp: '友達', kr: '친구', furigana: 'ともだち' },
                { jp: '家族', kr: '가족', furigana: 'かぞく' },
                { jp: '母', kr: '어머니', furigana: 'はは' },
                { jp: '父', kr: '아버지', furigana: 'ちち' },
                { jp: '本', kr: '책', furigana: 'ほん' },
                { jp: '机', kr: '책상', furigana: 'つくえ' },
                { jp: '時計', kr: '시계', furigana: 'とけい' },
                { jp: '電車', kr: '전철', furigana: 'でんしゃ' },
                { jp: '学校', kr: '학교', furigana: 'がっこう' },
                { jp: '会社', kr: '회사', furigana: 'かいしゃ' },
                { jp: '家', kr: '집', furigana: 'いえ' }
            ],
            '동사': [
                { jp: '食べる', kr: '먹다', furigana: 'たべる' },
                { jp: '飲む', kr: '마시다', furigana: 'のむ' },
                { jp: '見る', kr: '보다', furigana: 'みる' },
                { jp: '聞く', kr: '듣다', furigana: 'きく' },
                { jp: '行く', kr: '가다', furigana: 'いく' },
                { jp: '来る', kr: '오다', furigana: 'くる' },
                { jp: '帰る', kr: '돌아가다', furigana: 'かえる' },
                { jp: '乗る', kr: '타다', furigana: 'のる' },
                { jp: '降りる', kr: '내리다', furigana: 'おりる' },
                { jp: '歩く', kr: '걷다', furigana: 'あるく' },
                { jp: '走る', kr: '달리다', furigana: 'はしる' },
                { jp: '買う', kr: '사다', furigana: 'かう' },
                { jp: '売る', kr: '팔다', furigana: 'うる' },
                { jp: '作る', kr: '만들다', furigana: 'つくる' },
                { jp: '読む', kr: '읽다', furigana: 'よむ' },
                { jp: '書く', kr: '쓰다', furigana: 'かく' },
                { jp: '話す', kr: '말하다', furigana: 'はなす' },
                { jp: '言う', kr: '말하다', furigana: 'いう' },
                { jp: '勉強する', kr: '공부하다', furigana: 'べんきょうする' },
                { jp: '働く', kr: '일하다', furigana: 'はたらく' },
                { jp: '休む', kr: '쉬다', furigana: 'やすむ' },
                { jp: '寝る', kr: '자다', furigana: 'ねる' },
                { jp: '起きる', kr: '일어나다', furigana: 'おきる' }
            ],
            '형용사': [
                { jp: '大きい', kr: '크다', furigana: 'おおきい' },
                { jp: '小さい', kr: '작다', furigana: 'ちいさい' },
                { jp: '高い', kr: '높다/비싸다', furigana: 'たかい' },
                { jp: '低い', kr: '낮다', furigana: 'ひくい' },
                { jp: '安い', kr: '싸다', furigana: 'やすい' },
                { jp: '新しい', kr: '새롭다', furigana: 'あたらしい' },
                { jp: '古い', kr: '오래되다', furigana: 'ふるい' },
                { jp: '良い', kr: '좋다', furigana: 'よい' },
                { jp: '悪い', kr: '나쁘다', furigana: 'わるい' },
                { jp: '美味しい', kr: '맛있다', furigana: 'おいしい' },
                { jp: 'まずい', kr: '맛없다', furigana: null },
                { jp: '面白い', kr: '재미있다', furigana: 'おもしろい' },
                { jp: 'つまらない', kr: '재미없다', furigana: null },
                { jp: '楽しい', kr: '즐겁다', furigana: 'たのしい' },
                { jp: '嬉しい', kr: '기쁘다', furigana: 'うれしい' },
                { jp: '悲しい', kr: '슬프다', furigana: 'かなしい' },
                { jp: '怖い', kr: '무섭다', furigana: 'こわい' },
                { jp: '危ない', kr: '위험하다', furigana: 'あぶない' },
                { jp: '暖かい', kr: '따뜻하다', furigana: 'あたたかい' },
                { jp: '寒い', kr: '춥다', furigana: 'さむい' },
                { jp: '暑い', kr: '덥다', furigana: 'あつい' },
                { jp: '涼しい', kr: '시원하다', furigana: 'すずしい' },
                { jp: '熱い', kr: '뜨겁다', furigana: 'あつい' },
                { jp: '冷たい', kr: '차갑다', furigana: 'つめたい' },
                { jp: '明るい', kr: '밝다', furigana: 'あかるい' },
                { jp: '暗い', kr: '어둡다', furigana: 'くらい' },
                { jp: '近い', kr: '가깝다', furigana: 'ちかい' },
                { jp: '遠い', kr: '멀다', furigana: 'とおい' },
                { jp: '早い', kr: '이르다', furigana: 'はやい' },
                { jp: '遅い', kr: '늦다', furigana: 'おそい' },
                { jp: '忙しい', kr: '바쁘다', furigana: 'いそがしい' }
            ]
        };

        // 문장 퀴즈 데이터 (4지선다형으로 변경)
        const sentenceQuizData = [
            { 
                question: 'これは なに？', 
                korean: '이것은 무엇인가요?',
                options: ['이것은 무엇인가요?', '그것은 무엇인가요?', '저것은 무엇인가요?', '어느것은 무엇인가요?'],
                correct: 0,
                hiragana: 'これは なに？'
            },
            { 
                question: 'それは なんですか？', 
                korean: '그것은 무엇입니까?',
                options: ['이것은 무엇입니까?', '그것은 무엇입니까?', '저것은 무엇입니까?', '어느것은 무엇입니까?'],
                correct: 1,
                hiragana: 'それは なんですか？'
            },
            { 
                question: 'だれですか？', 
                korean: '누구입니까?',
                options: ['언제입니까?', '누구입니까?', '어디입니까?', '무엇입니까?'],
                correct: 1,
                hiragana: 'だれですか？'
            },
            { 
                question: 'どこですか？', 
                korean: '어디입니까?',
                options: ['언제입니까?', '누구입니까?', '어디입니까?', '어떻습니까?'],
                correct: 2,
                hiragana: 'どこですか？'
            },
            { 
                question: 'いつですか？', 
                korean: '언제입니까?',
                options: ['언제입니까?', '누구입니까?', '어디입니까?', '무엇입니까?'],
                correct: 0,
                hiragana: 'いつですか？'
            },
            { 
                question: 'どうですか？', 
                korean: '어떻습니까?',
                options: ['언제입니까?', '어디입니까?', '누구입니까?', '어떻습니까?'],
                correct: 3,
                hiragana: 'どうですか？'
            },
            { 
                question: '好きな 色は なに？', 
                korean: '좋아하는 색은 무엇인가요?',
                options: ['좋아하는 색은 무엇인가요?', '좋아하는 음식은 무엇인가요?', '좋아하는 동물은 무엇인가요?', '좋아하는 스포츠는 무엇인가요?'],
                correct: 0,
                hiragana: 'すきな いろは なに？'
            },
            { 
                question: '何時から？', 
                korean: '몇 시부터예요?',
                options: ['몇 시까지예요?', '몇 시부터예요?', '몇 시예요?', '몇 분 걸려요?'],
                correct: 1,
                hiragana: 'なんじから？'
            },
            { 
                question: '何時まで？', 
                korean: '몇 시까지예요?',
                options: ['몇 시부터예요?', '몇 시예요?', '몇 시까지예요?', '몇 분 걸려요?'],
                correct: 2,
                hiragana: 'なんじまで？'
            },
            { 
                question: 'いつ 来るの？', 
                korean: '언제 와요?',
                options: ['언제 가요?', '언제 와요?', '언제 해요?', '언제 봐요?'],
                correct: 1,
                hiragana: 'いつ くるの？'
            }
        ];

        // 전역 변수
        let knownWords = JSON.parse(localStorage.getItem('knownWords') || '[]');
        let bookmarkedWords = JSON.parse(localStorage.getItem('bookmarkedWords') || '[]');
        let wordStates = {};
        let currentMode = 'study';
        let currentCategory = 'all';
        let currentLevel = 'lesson';
        let currentWordQuizIndex = 0;
        let currentSentenceIndex = 0;
        let wordQuizQuestions = [];
        let currentWordAnswer = '';
        let currentWordFurigana = '';
        let sentenceQuizQuestions = [];
        let currentSentenceAnswer = 0;

        // 메뉴 토글 및 외부 클릭 처리
        function toggleMenu() {
            const dropdown = document.getElementById('menuDropdown');
            dropdown.classList.toggle('show');
        }

        // 외부 클릭 시 메뉴 닫기
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('menuDropdown');
            const menuBtn = document.querySelector('.menu-btn');
            
            if (!menuBtn.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // 탭 전환
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('menuDropdown').classList.remove('show');
            
            if (tab === 'wordQuiz') {
                initWordQuiz();
            } else if (tab === 'sentenceQuiz') {
                initSentenceQuiz();
            }
        }

        // 모드 전환
        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('study-mode').classList.add('hidden');
            document.getElementById('known-mode').classList.add('hidden');
            
            if (mode === 'study') {
                document.getElementById('study-mode').classList.remove('hidden');
                renderStudyWords();
                updateStats();
                updateCounts();
            } else if (mode === 'known') {
                document.getElementById('known-mode').classList.remove('hidden');
                renderKnownWords();
            }
        }

        // 레벨 필터
        function filterLevel() {
            currentLevel = document.getElementById('levelFilter').value;
            currentCategory = 'all';
            document.getElementById('categoryFilter').value = 'all';
            updateCategoryOptions();
            renderStudyWords();
            updateStats();
            updateCounts(); // 카운트도 업데이트
        }

        // 카테고리 옵션 업데이트
        function updateCategoryOptions() {
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="all">전체 보기</option>';
            
            const dataSource = getDataSource();
            Object.keys(dataSource).forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categoryFilter.appendChild(option);
            });
        }

        // 데이터 소스 가져오기
        function getDataSource() {
            switch(currentLevel) {
                case 'lesson': return lessonVocabulary;
                case 'n5': return n5Vocabulary;
                case 'n4': return n4Vocabulary;
                case 'n3': return n3Vocabulary;
                default: return lessonVocabulary;
            }
        }

        // 카테고리 필터
        function filterCategory() {
            currentCategory = document.getElementById('categoryFilter').value;
            renderStudyWords();
            updateStats();
            updateCounts(); // 카운트도 업데이트
        }

        // 책갈피 토글 (한 번에 하나만 선택)
        function toggleBookmark(word) {
            const index = bookmarkedWords.findIndex(bw => 
                bw.jp === word.jp && bw.kr === word.kr
            );
            
            if (index > -1) {
                // 이미 북마크된 경우 제거
                bookmarkedWords.splice(index, 1);
            } else {
                // 새로운 북마크 - 기존 북마크 모두 제거하고 새로운 것만 추가
                bookmarkedWords = [word];
            }
            
            localStorage.setItem('bookmarkedWords', JSON.stringify(bookmarkedWords));
            renderStudyWords();
            updateCounts();
        }

        // 모든 책갈피 제거 (사용안함)
        function clearAllBookmarks() {
            // 책갈피는 시각적 표시만 하므로 별도 제거 기능 불필요
        }

        // 모든 단어 가져오기
        function getAllWords() {
            const dataSource = getDataSource();
            let words = [];
            let globalIndex = 0;
            
            if (currentCategory === 'all') {
                Object.keys(dataSource).forEach(cat => {
                    dataSource[cat].forEach(word => {
                        words.push({ ...word, category: cat, globalIndex: globalIndex++ });
                    });
                });
            } else {
                dataSource[currentCategory]?.forEach(word => {
                    words.push({ ...word, category: currentCategory, globalIndex: globalIndex++ });
                });
            }
            return words;
        }

        // 학습 단어 가져오기
        function getStudyWords() {
            const allWords = getAllWords();
            return allWords.filter(word => 
                !knownWords.find(kw => kw.jp === word.jp && kw.kr === word.kr)
            );
        }

        // 통계 업데이트
        function updateStats() {
            const studyWords = getStudyWords();
            const allWords = getAllWords();
            const learnedCount = allWords.length - studyWords.length;
            const percentage = allWords.length > 0 ? Math.round((learnedCount / allWords.length) * 100) : 0;
            
            document.getElementById('totalWords').textContent = allWords.length;
            document.getElementById('learnedPercentage').textContent = `${percentage}%`;
        }

        // 스크롤 진행률 업데이트
        function updateScrollProgress() {
            const container = document.getElementById('vocab-list');
            const scrollTop = container.scrollTop;
            const scrollHeight = container.scrollHeight - container.clientHeight;
            const scrollPercentage = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 0;
            
            const visibleCards = container.querySelectorAll('.interactive-word-card');
            let currentVisible = 0;
            
            for (let i = 0; i < visibleCards.length; i++) {
                const rect = visibleCards[i].getBoundingClientRect();
                if (rect.top < window.innerHeight / 2) {
                    currentVisible = i + 1;
                }
            }
            
            document.getElementById('currentPosition').textContent = currentVisible;
            document.getElementById('scrollProgressBar').style.width = `${scrollPercentage}%`;
            document.getElementById('scrollIndicator').textContent = `${currentVisible} / ${visibleCards.length}`;
            
            if (scrollPercentage > 0) {
                document.getElementById('scrollProgress').classList.add('visible');
                document.getElementById('scrollIndicator').classList.add('visible');
            }
            
            clearTimeout(window.scrollTimeout);
            window.scrollTimeout = setTimeout(() => {
                document.getElementById('scrollProgress').classList.remove('visible');
                document.getElementById('scrollIndicator').classList.remove('visible');
            }, 2000);
        }

        // 카운트 업데이트
        function updateCounts() {
            document.getElementById('study-count').textContent = getStudyWords().length;
            document.getElementById('known-count').textContent = knownWords.length;
            updateStats();
        }

        // 후리가나 토글
        function toggleFurigana(wordId) {
            wordStates[wordId] = wordStates[wordId] || {};
            wordStates[wordId].showFurigana = !wordStates[wordId].showFurigana;
            renderStudyWords();
        }

        // 의미 토글
        function toggleMeaning(wordId) {
            wordStates[wordId] = wordStates[wordId] || {};
            wordStates[wordId].showMeaning = !wordStates[wordId].showMeaning;
            renderStudyWords();
        }

        // 아는 단어로 마크
        function markAsKnown(word) {
            knownWords.push(word);
            localStorage.setItem('knownWords', JSON.stringify(knownWords));
            renderStudyWords();
            updateStats();
            updateCounts();
        }

        // 단어 복원
        function restoreWord(word) {
            knownWords = knownWords.filter(kw => 
                !(kw.jp === word.jp && kw.kr === word.kr)
            );
            localStorage.setItem('knownWords', JSON.stringify(knownWords));
            if (currentMode === 'known') renderKnownWords();
            if (currentMode === 'study') renderStudyWords();
            updateStats();
            updateCounts();
        }

        // 모든 단어 복원
        function restoreAll() {
            if (confirm('모든 아는 단어를 되돌리시겠습니까?')) {
                knownWords = [];
                wordStates = {};
                localStorage.setItem('knownWords', JSON.stringify(knownWords));
                if (currentMode === 'known') renderKnownWords();
                if (currentMode === 'study') renderStudyWords();
                updateStats();
                updateCounts();
            }
        }

        // 학습 단어 렌더링
        function renderStudyWords() {
            const container = document.getElementById('vocab-list');
            const words = getStudyWords();
            
            if (words.length === 0) {
                container.innerHTML = '<div class="empty-message">모든 단어를 학습했습니다! 🎉</div>';
                return;
            }

            container.innerHTML = words.map((word, idx) => {
                const wordId = `${word.jp}_${idx}`;
                const state = wordStates[wordId] || {};
                const hasKanji = /[一-龯]/.test(word.jp);
                const isBookmarked = bookmarkedWords.find(bw => 
                    bw.jp === word.jp && bw.kr === word.kr
                );
                
                let japaneseHtml = word.jp;
                if (state.showFurigana && word.furigana && hasKanji) {
                    japaneseHtml = `<ruby>${word.jp}<rt>${word.furigana}</rt></ruby>`;
                }

                return `
                    <div class="interactive-word-card" data-word-index="${word.globalIndex}">
                        <span class="bookmark-star ${isBookmarked ? 'active' : ''}" 
                            onclick='toggleBookmark(${JSON.stringify(word).replace(/'/g, "\\'")})'>
                            ${isBookmarked ? '★' : '☆'}
                        </span>
                        <div class="word-column">
                            <div class="japanese-word">${japaneseHtml}</div>
                            ${state.showMeaning ? `<div class="word-meaning">${word.kr}</div>` : ''}
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn-small ${state.showFurigana ? 'active' : ''}" 
                                onclick="toggleFurigana('${wordId}')"
                                ${!hasKanji || !word.furigana ? 'disabled' : ''}>あ</button>
                            <button class="action-btn-small ${state.showMeaning ? 'active' : ''}" 
                                onclick="toggleMeaning('${wordId}')">뜻</button>
                            <button class="action-btn-small btn-know" 
                                onclick='markAsKnown(${JSON.stringify(word).replace(/'/g, "\\'")})'>안다</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateScrollProgress();
        }

        // 완료된 단어 렌더링
        function renderKnownWords() {
            const container = document.getElementById('known-list');
            
            if (knownWords.length === 0) {
                container.innerHTML = '<div class="empty-message">아직 완료한 단어가 없습니다.</div>';
                return;
            }

            container.innerHTML = knownWords.map(word => `
                <div class="known-word-card" onclick='restoreWord(${JSON.stringify(word).replace(/'/g, "\\'")})'>
                    <div style="font-size: 1.1rem; font-weight: bold; margin-bottom: 4px;">${word.jp}</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">${word.kr}</div>
                    <div style="font-size: 0.7rem; opacity: 0.6; margin-top: 3px;">✓ 완료 - 탭하여 복원</div>
                </div>
            `).join('');
        }

        // 단어 퀴즈 초기화
        function initWordQuiz() {
            // 모든 레벨의 단어 합치기
            const allWords = [];
            [lessonVocabulary, n5Vocabulary, n4Vocabulary, n3Vocabulary].forEach(vocab => {
                Object.values(vocab).forEach(category => {
                    allWords.push(...category);
                });
            });

            // 랜덤으로 20문제 선택
            wordQuizQuestions = [];
            const shuffled = allWords.sort(() => 0.5 - Math.random());
            wordQuizQuestions = shuffled.slice(0, Math.min(20, shuffled.length));
            
            currentWordQuizIndex = 0;
            loadWordQuestion();
        }

        // 단어 퀴즈 문제 로드
        function loadWordQuestion() {
            if (currentWordQuizIndex >= wordQuizQuestions.length) {
                currentWordQuizIndex = 0;
            }

            const question = wordQuizQuestions[currentWordQuizIndex];
            const correctAnswer = question.kr;
            currentWordAnswer = correctAnswer;
            currentWordFurigana = question.furigana;

            // 오답 선택지 생성
            const allAnswers = [];
            [lessonVocabulary, n5Vocabulary, n4Vocabulary, n3Vocabulary].forEach(vocab => {
                Object.values(vocab).forEach(category => {
                    category.forEach(word => allAnswers.push(word.kr));
                });
            });

            const wrongAnswers = allAnswers
                .filter(answer => answer !== correctAnswer)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);

            const options = [correctAnswer, ...wrongAnswers].sort(() => 0.5 - Math.random());

            // 화면에 표시
            document.getElementById('word-quiz-question').textContent = question.jp;
            
            const optionsContainer = document.getElementById('word-quiz-options');
            optionsContainer.innerHTML = options.map((option, index) => `
                <button class="quiz-option" onclick="selectWordAnswer(${index})">${option}</button>
            `).join('');

            document.getElementById('word-quiz-result').classList.add('hidden');
            document.getElementById('word-quiz-progress').textContent = 
                `${currentWordQuizIndex + 1} / ${wordQuizQuestions.length}`;
        }

        // 단어 퀴즈 답 선택
        function selectWordAnswer(index) {
            const options = document.querySelectorAll('.quiz-option');
            const selectedAnswer = options[index].textContent;
            
            options.forEach(opt => opt.classList.add('disabled'));
            
            if (selectedAnswer === currentWordAnswer) {
                options[index].classList.add('correct');
            } else {
                options[index].classList.add('incorrect');
                options.forEach((opt, i) => {
                    if (opt.textContent === currentWordAnswer) {
                        opt.classList.add('correct');
                    }
                });
            }

            // 정답 표시
            const resultDiv = document.getElementById('word-quiz-result');
            resultDiv.classList.remove('hidden');
            
            const question = wordQuizQuestions[currentWordQuizIndex];
            let answerHtml = `${question.jp} = ${currentWordAnswer}`;
            if (currentWordFurigana) {
                answerHtml += `<br><span style="font-size: 0.9em; opacity: 0.8;">${currentWordFurigana}</span>`;
            }
            
            document.getElementById('word-quiz-answer').innerHTML = answerHtml;
            document.getElementById('word-quiz-furigana').textContent = '';
        }

        // 다음 단어 퀴즈
        function nextWordQuestion() {
            currentWordQuizIndex++;
            loadWordQuestion();
        }

        // 문장 퀴즈 초기화
        function initSentenceQuiz() {
            sentenceQuizQuestions = [...sentenceQuizData].sort(() => 0.5 - Math.random());
            currentSentenceIndex = 0;
            loadSentenceQuestion();
        }

        // 문장 퀴즈 문제 로드
        function loadSentenceQuestion() {
            if (currentSentenceIndex >= sentenceQuizQuestions.length) {
                currentSentenceIndex = 0;
            }

            const question = sentenceQuizQuestions[currentSentenceIndex];
            currentSentenceAnswer = question.correct;

            // 화면에 표시
            document.getElementById('sentence-quiz-question').textContent = question.question;
            
            const optionsContainer = document.getElementById('sentence-quiz-options');
            optionsContainer.innerHTML = question.options.map((option, index) => `
                <button class="quiz-option" onclick="selectSentenceAnswer(${index})">${option}</button>
            `).join('');

            document.getElementById('sentence-quiz-result').classList.add('hidden');
            document.getElementById('sentence-quiz-progress').textContent = 
                `${currentSentenceIndex + 1} / ${sentenceQuizQuestions.length}`;
        }

        // 문장 퀴즈 답 선택
        function selectSentenceAnswer(index) {
            const options = document.querySelectorAll('#sentence-quiz-options .quiz-option');
            const selectedAnswer = index;
            
            options.forEach(opt => opt.classList.add('disabled'));
            
            if (selectedAnswer === currentSentenceAnswer) {
                options[index].classList.add('correct');
            } else {
                options[index].classList.add('incorrect');
                options[currentSentenceAnswer].classList.add('correct');
            }

            // 정답 표시
            const resultDiv = document.getElementById('sentence-quiz-result');
            resultDiv.classList.remove('hidden');
            
            const question = sentenceQuizQuestions[currentSentenceIndex];
            let answerHtml = `${question.question} = ${question.korean}`;
            if (question.hiragana) {
                answerHtml += `<br><span style="font-size: 0.9em; opacity: 0.8;">${question.hiragana}</span>`;
            }
            
            document.getElementById('sentence-quiz-answer').innerHTML = answerHtml;
            document.getElementById('sentence-quiz-furigana').textContent = '';
        }

        // 다음 문장 퀴즈
        function nextSentenceQuestion() {
            currentSentenceIndex++;
            loadSentenceQuestion();
        }

        // 초기화
        updateCategoryOptions();
        updateCounts();
        renderStudyWords();
        initSentenceQuiz();
    </script>
</body>
</html>